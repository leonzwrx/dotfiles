# Laptop idle timeouts
# Dim screen after 240 seconds on battery, and restore brightness on resume.
timeout 240 '[ -d /sys/class/power_supply/BAT0 ] && brightnessctl -s && brightnessctl set 10' resume '[ -d /sys/class/power_supply/BAT0 ] && brightnessctl -r'

# Lock screen after 600 seconds on battery. Add a resume command to restore brightness after unlock.
# This resume will only be triggered by the timeout on this line.
timeout 600 '[ -d /sys/class/power_supply/BAT0 ] && exec $HOME/.config/sway/scripts/lock.sh' resume 'brightnessctl -r'

# Turn off display after 750 seconds on battery, and restore on resume.
timeout 750 '[ -d /sys/class/power_supply/BAT0 ] && $HOME/.config/sway/scripts/kbd-backlight.sh off && swaymsg "output * power off"' resume '[ -d /sys/class/power_supply/BAT0 ] && $HOME/.config/sway/scripts/kbd-backlight.sh on && swaymsg "output * power on"'

# Suspend system after 900 seconds on battery. No resume command needed here, as the after-resume handler takes care of it.
timeout 900 '[ -d /sys/class/power_supply/BAT0 ] && systemctl suspend'

# Desktop idle timeouts
# Lock screen after 1800 seconds on desktop. No need for a resume command on this line because no dimming happens.
timeout 1800 '[ ! -d /sys/class/power_supply/BAT0 ] && exec $HOME/.config/sway/scripts/lock.sh'

# Common actions
before-sleep 'playerctl pause'
before-sleep 'exec $HOME/.config/sway/scripts/lock.sh & sleep 2'
# This handles brightness restoration after the system resumes from suspend.
after-resume 'sleep 2 && [ -d /sys/class/power_supply/BAT0 ] && $HOME/.config/sway/scripts/kbd-backlight.sh on && swaymsg "output * power on" && brightnessctl set 465'
